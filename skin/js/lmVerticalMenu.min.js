/**
 * 响应式两级菜单，垂直型，支持IE8+
 * 个人学习作品
 * author lming_60@foxmail.com
 **/

!function(a,b){var c=function(){this.largeScreen=!0};c.prototype.init=function(c){var e,d=this;d.$elem=a(c),d.largeScreen=a(b).width()<768?!1:!0,e="菜单",d.$elem.data("current")&&(e=d.$elem.data("current")),d.$btn=a('<div class="m-menu-toggle">'+e+"</div>").prependTo(d.$elem),d.$two=a("ul > li > ul > li > a",d.$elem).addClass("2nd"),d.$sub=a("ul > li > ul",d.$elem),d.$one=a("a:not(.2nd)",d.$elem),d.update(),d.response(),d.build(),d.openInit()},c.prototype.response=function(){var d,e,f,c=this;e=a(b).width(),c.resizer=function(){a(b).width()!==e&&(b.clearTimeout(d),d=b.setTimeout(function(){e=a(b).width(),f=768>e?!1:!0,c.largeScreen!==f&&(c.largeScreen=f,c.update())},600))},a(b).resize(c.resizer)},c.prototype.openInit=function(){var b,a=this;a.largeScreen?(b=a.$elem.find("li.on").children("ul"),b.height(b.children(":first").height()*b.children().length)):a.$elem.find("li.on").removeClass("on")},c.prototype.update=function(){var a=this;a.largeScreen?(a.$btn.addClass("hide").removeClass("on"),a.$one.addClass("mod-one"),a.$elem.children("ul").removeClass("m-menu hide"),a.$sub.length&&(a.$sub.addClass("sub"),a.$two.addClass("mod-two"))):(a.$btn.removeClass("hide"),a.$one.removeClass("mod-one"),a.$elem.children("ul").addClass("m-menu hide"),a.$sub.length&&(a.$sub.removeClass("sub").removeAttr("style"),a.$two.removeClass("mod-two")))},c.prototype.build=function(){var b=this;b.$one.on("click",function(c){var e,f,d=a(this);b.largeScreen&&d.next().length&&(c.preventDefault(),e=d.parent(),f=d.next(),b.$sub.removeAttr("style"),e.hasClass("on")?e.removeClass("on"):(f.height(f.children(":first").height()*f.children().length),e.addClass("on").siblings().removeClass("on")))}),b.$btn.on("click",function(){var b=a(this);b.hasClass("on")?(b.removeClass("on"),b.next().addClass("hide")):(b.addClass("on"),b.next().removeClass("hide"))})},a.fn.lmVerticalMenu=function(){return this.each(function(){var a=new c;a.init(this)})}}(jQuery,window);